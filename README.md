# X 评论实时监控与 AI 分析系统

一个用于实时采集、分析、筛选和排序 X/Twitter 评论的舆情监控网页应用。

## 核心功能

### 1. 评论监控
- 支持按 Tweet ID 监控指定推文的评论
- 实时刷新（30秒自动轮询）
- 新评论提示，不打断阅读

### 2. AI 智能分析
- **情绪分析**：自动识别评论情绪
  - positive（支持、认可）
  - neutral（陈述、围观）
  - negative（不满、批评）
  - anger（愤怒、攻击）
  - sarcasm（讽刺、阴阳）
- **价值评分**：0-1 分评估评论价值
  - 信息增量
  - 代表性观点
  - 影响力
  - 传播性
- **观点摘要**：一句话总结评论核心观点

### 3. 多维度筛选
- 按时间范围筛选（10分钟/1小时/24小时/7天）
- 按情绪类型筛选（多选）
- 按价值评分筛选（滑动条 + 快捷按钮）
- 按评论人筛选（支持搜索 @handle）

### 4. 智能排序
- 时间新→旧（默认）
- 时间旧→新
- 价值高→低
- 点赞数高→低

### 5. 数据可视化
- 情绪分布饼图
- 价值评分直方图
- 情绪趋势图（时间轴）
- 观点聚类分析（3-5 种主要观点）

## 使用指南

### 快速开始

1. **登录系统**：点击右上角登录按钮
2. **输入监控目标**：在左侧输入要监控的 Tweet ID
3. **导入评论数据**：进入设置页面，手动导入评论 JSON 数据
4. **触发 AI 分析**：在设置页面点击"分析未处理评论"

### 导入评论数据

由于 Twitter API 限制，系统支持手动导入评论数据。JSON 格式示例：

```json
[
  {
    "replyId": "123456789",
    "authorId": "user123",
    "authorName": "用户昵称",
    "authorHandle": "username",
    "text": "评论内容",
    "createdAt": "2024-01-01T12:00:00Z",
    "likeCount": 10
  }
]
```

### 筛选技巧

- **快速查看高价值评论**：点击"高价值"按钮，只显示评分 ≥ 0.7 的评论
- **排除噪音**：点击"排除噪音"按钮，过滤低价值评论
- **追踪特定用户**：在评论人筛选中输入 @handle
- **查看情绪异常**：勾选"愤怒"和"讽刺"情绪类型

### API 配置（可选）

如需扩展数据采集能力，可在设置页面配置：
- Twitter Bearer Token
- RapidAPI Key

## 技术架构

```
前端（React + TypeScript）
    ↓
tRPC API
    ↓
后端（Express + Node.js）
    ↓
数据库（MySQL/TiDB）+ AI 分析（内置 LLM）
```

### 数据库表结构

**raw_comments（原始评论表）**
| 字段 | 说明 |
|------|------|
| reply_id | 评论唯一 ID |
| tweet_id | 所属 Tweet |
| author_id | 评论人 ID |
| author_name | 评论人昵称 |
| author_handle | @用户名 |
| text | 评论内容 |
| created_at | 评论时间 |
| like_count | 点赞数 |
| reply_to | 回复对象 ID |

**analyzed_comments（AI 分析结果表）**
| 字段 | 说明 |
|------|------|
| reply_id | 评论 ID |
| sentiment | 情绪类型 |
| value_score | 价值评分 (0-1) |
| value_type | 价值类型数组 |
| summary | 一句话摘要 |
| analyzed_at | 分析时间 |

## 开发说明

### 本地开发

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 运行测试
pnpm test

# 数据库迁移
pnpm db:push
```

### 环境变量

系统已预配置以下环境变量：
- `DATABASE_URL` - 数据库连接
- `JWT_SECRET` - 会话密钥
- `BUILT_IN_FORGE_API_*` - 内置 AI API

## 注意事项

1. **关于 Twitter API**：内置 Data API 支持获取用户资料和推文，但暂不支持直接获取推文回复。建议使用手动导入功能或配置第三方 API。

2. **AI 分析配额**：系统使用内置 LLM 服务，无需额外配置。批量分析时建议每次处理 5-10 条评论。

3. **数据存储**：所有评论数据存储在数据库中，支持长期保存和历史查询。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持评论导入和 AI 分析
- 多维度筛选和排序
- 数据可视化图表
- 观点聚类分析
